janitor::clean_names() %>%
dplyr::mutate(date = as.Date(date, "%d %b %Y"),
value = as.numeric(value))
unlink(temp)
output
}
get_boe("xumauss")
series = "xumauss"
from = as.Date("1975-01-01")
to = Sys.Date()
url <- paste0("http://www.bankofengland.co.uk/boeapps/iadb/fromshowcolumns.asp?csv.x=yes",
"&Datefrom=", format.Date(from, "%d/%b/%Y"),
"&Dateto=", format.Date(to, "%d/%b/%Y"),
"&SeriesCodes=", paste(toupper(series), collapse = ","),
"&CSVF=CN&UsingCodes=Y&VPD=Y&VFD=N")
temp <- tempfile()
utils::download.file(url, destfile = temp, quiet = T)
output <- readr::read_csv(temp, col_types = readr::cols()) %>%
janitor::clean_names() %>%
dplyr::mutate(date = as.Date(date, "%d %b %Y"),
value = as.numeric(value))
unlink(temp)
output
get_boe(series)
ncol(suppressMessages(suppressWarnings(readr::read_csv(temp) <= 1)))
temp <- tempfile()
utils::download.file(url, destfile = temp, quiet = T)
ncol(suppressMessages(suppressWarnings(readr::read_csv(temp) <= 1)))
output <- readr::read_csv(temp, col_types = readr::cols()) %>%
janitor::clean_names() %>%
dplyr::mutate(date = as.Date(date, "%d %b %Y"),
value = as.numeric(value))
unlink(temp)
output
library(economi)
get_boe("xumauss")
from = as.Date("1975-01-01")
to = Sys.Date()
series = "xumauss"
url <- paste0("http://www.bankofengland.co.uk/boeapps/iadb/fromshowcolumns.asp?csv.x=yes",
"&Datefrom=", format.Date(from, "%d/%b/%Y"),
"&Dateto=", format.Date(to, "%d/%b/%Y"),
"&SeriesCodes=", paste(toupper(series), collapse = ","),
"&CSVF=CN&UsingCodes=Y&VPD=Y&VFD=N")
temp <- tempfile()
utils::download.file(url, destfile = temp, quiet = T)
if(ncol(suppressMessages(suppressWarnings(readr::read_csv(temp) <= 1))))
stop("unkwown series")
output <- readr::read_csv(temp, col_types = readr::cols()) %>%
janitor::clean_names() %>%
dplyr::mutate(date = as.Date(date, "%d %b %Y"),
value = as.numeric(value))
get_boe <- function(series, from = as.Date("1975-01-01"), to = Sys.Date()){
if(class(from) != "Date" | class(to) != "Date")
stop("to and from must be dates")
url <- paste0("http://www.bankofengland.co.uk/boeapps/iadb/fromshowcolumns.asp?csv.x=yes",
"&Datefrom=", format.Date(from, "%d/%b/%Y"),
"&Dateto=", format.Date(to, "%d/%b/%Y"),
"&SeriesCodes=", paste(toupper(series), collapse = ","),
"&CSVF=CN&UsingCodes=Y&VPD=Y&VFD=N")
temp <- tempfile()
utils::download.file(url, destfile = temp, quiet = T)
if(ncol(suppressMessages(suppressWarnings(readr::read_csv(temp) == 1))))
stop("unkwown series")
output <- readr::read_csv(temp, col_types = readr::cols()) %>%
janitor::clean_names() %>%
dplyr::mutate(date = as.Date(date, "%d %b %Y"),
value = as.numeric(value))
unlink(temp)
output
}
get_boe("xumauss")
ncol(suppressMessages(suppressWarnings(readr::read_csv(temp) == 1)))
get_boe <- function(series, from = as.Date("1975-01-01"), to = Sys.Date()){
if(class(from) != "Date" | class(to) != "Date")
stop("to and from must be dates")
url <- paste0("http://www.bankofengland.co.uk/boeapps/iadb/fromshowcolumns.asp?csv.x=yes",
"&Datefrom=", format.Date(from, "%d/%b/%Y"),
"&Dateto=", format.Date(to, "%d/%b/%Y"),
"&SeriesCodes=", paste(toupper(series), collapse = ","),
"&CSVF=CN&UsingCodes=Y&VPD=Y&VFD=N")
temp <- tempfile()
utils::download.file(url, destfile = temp, quiet = T)
if(ncol(suppressMessages(suppressWarnings(readr::read_csv(temp) != 3))))
stop("unkwown series")
output <- readr::read_csv(temp, col_types = readr::cols()) %>%
janitor::clean_names() %>%
dplyr::mutate(date = as.Date(date, "%d %b %Y"),
value = as.numeric(value))
unlink(temp)
output
}
get_boe("xumauss")
ncol(suppressMessages(suppressWarnings(readr::read_csv(temp))))
get_boe <- function(series, from = as.Date("1975-01-01"), to = Sys.Date()){
if(class(from) != "Date" | class(to) != "Date")
stop("to and from must be dates")
url <- paste0("http://www.bankofengland.co.uk/boeapps/iadb/fromshowcolumns.asp?csv.x=yes",
"&Datefrom=", format.Date(from, "%d/%b/%Y"),
"&Dateto=", format.Date(to, "%d/%b/%Y"),
"&SeriesCodes=", paste(toupper(series), collapse = ","),
"&CSVF=CN&UsingCodes=Y&VPD=Y&VFD=N")
temp <- tempfile()
utils::download.file(url, destfile = temp, quiet = T)
if(ncol(suppressMessages(suppressWarnings(readr::read_csv(temp) == 1))))
stop("unkwown series")
output <- readr::read_csv(temp, col_types = readr::cols()) %>%
janitor::clean_names() %>%
dplyr::mutate(date = as.Date(date, "%d %b %Y"),
value = as.numeric(value))
unlink(temp)
output
}
get_boe("xumauss")
get_boe("xumauss")
get_boe <- function(series, from = as.Date("1975-01-01"), to = Sys.Date()){
if(class(from) != "Date" | class(to) != "Date")
stop("to and from must be dates")
url <- paste0("http://www.bankofengland.co.uk/boeapps/iadb/fromshowcolumns.asp?csv.x=yes",
"&Datefrom=", format.Date(from, "%d/%b/%Y"),
"&Dateto=", format.Date(to, "%d/%b/%Y"),
"&SeriesCodes=", paste(toupper(series), collapse = ","),
"&CSVF=CN&UsingCodes=Y&VPD=Y&VFD=N")
temp <- tempfile()
utils::download.file(url, destfile = temp, quiet = T)
output <- readr::read_csv(temp, col_types = readr::cols()) %>%
janitor::clean_names() %>%
dplyr::mutate(date = as.Date(date, "%d %b %Y"),
value = as.numeric(value))
unlink(temp)
output
}
get_boe("xumauss")
get_boe <- function(series, from = as.Date("1975-01-01"), to = Sys.Date()){
if(class(from) != "Date" | class(to) != "Date")
stop("to and from must be dates")
url <- paste0("http://www.bankofengland.co.uk/boeapps/iadb/fromshowcolumns.asp?csv.x=yes",
"&Datefrom=", format.Date(from, "%d/%b/%Y"),
"&Dateto=", format.Date(to, "%d/%b/%Y"),
"&SeriesCodes=", paste(toupper(series), collapse = ","),
"&CSVF=CN&UsingCodes=Y&VPD=Y&VFD=N")
temp <- tempfile()
utils::download.file(url, destfile = temp, quiet = T)
if(ncol(readr::read_csv(temp) == 1))
stop("unkwown series")
output <- readr::read_csv(temp, col_types = readr::cols()) %>%
janitor::clean_names() %>%
dplyr::mutate(date = as.Date(date, "%d %b %Y"),
value = as.numeric(value))
unlink(temp)
output
}
get_boe("xumauss")
get_boe <- function(series, from = as.Date("1975-01-01"), to = Sys.Date()){
if(class(from) != "Date" | class(to) != "Date")
stop("to and from must be dates")
url <- paste0("http://www.bankofengland.co.uk/boeapps/iadb/fromshowcolumns.asp?csv.x=yes",
"&Datefrom=", format.Date(from, "%d/%b/%Y"),
"&Dateto=", format.Date(to, "%d/%b/%Y"),
"&SeriesCodes=", paste(toupper(series), collapse = ","),
"&CSVF=CN&UsingCodes=Y&VPD=Y&VFD=N")
temp <- tempfile()
utils::download.file(url, destfile = temp, quiet = T)
if(ncol(readr::read_csv(temp) == "1"))
stop("unkwown series")
output <- readr::read_csv(temp, col_types = readr::cols()) %>%
janitor::clean_names() %>%
dplyr::mutate(date = as.Date(date, "%d %b %Y"),
value = as.numeric(value))
unlink(temp)
output
}
get_boe("xumauss")
series("xumauss")
series <- "xumauss"
from = as.Date("1975-01-01")
to = Sys.Date()
url <- paste0("http://www.bankofengland.co.uk/boeapps/iadb/fromshowcolumns.asp?csv.x=yes",
"&Datefrom=", format.Date(from, "%d/%b/%Y"),
"&Dateto=", format.Date(to, "%d/%b/%Y"),
"&SeriesCodes=", paste(toupper(series), collapse = ","),
"&CSVF=CN&UsingCodes=Y&VPD=Y&VFD=N")
temp <- tempfile()
utils::download.file(url, destfile = temp, quiet = T)
the <- ncol(readr::read_csv(temp)
the <- ncol(readr::read_csv(temp))
the
as.numeric(the)
class(the)
class(as.numeric(the))
get_boe <- function(series, from = as.Date("1975-01-01"), to = Sys.Date()){
if(class(from) != "Date" | class(to) != "Date")
stop("to and from must be dates")
url <- paste0("http://www.bankofengland.co.uk/boeapps/iadb/fromshowcolumns.asp?csv.x=yes",
"&Datefrom=", format.Date(from, "%d/%b/%Y"),
"&Dateto=", format.Date(to, "%d/%b/%Y"),
"&SeriesCodes=", paste(toupper(series), collapse = ","),
"&CSVF=CN&UsingCodes=Y&VPD=Y&VFD=N")
temp <- tempfile()
utils::download.file(url, destfile = temp, quiet = T)
if(as.numeric(ncol(readr::read_csv(temp)) == "1"))
stop("unkwown series")
output <- readr::read_csv(temp, col_types = readr::cols()) %>%
janitor::clean_names() %>%
dplyr::mutate(date = as.Date(date, "%d %b %Y"),
value = as.numeric(value))
unlink(temp)
output
}
get_boe("xumauss")
get_boe <- function(series, from = as.Date("1975-01-01"), to = Sys.Date()){
if(class(from) != "Date" | class(to) != "Date")
stop("to and from must be dates")
url <- paste0("http://www.bankofengland.co.uk/boeapps/iadb/fromshowcolumns.asp?csv.x=yes",
"&Datefrom=", format.Date(from, "%d/%b/%Y"),
"&Dateto=", format.Date(to, "%d/%b/%Y"),
"&SeriesCodes=", paste(toupper(series), collapse = ","),
"&CSVF=CN&UsingCodes=Y&VPD=Y&VFD=N")
temp <- tempfile()
utils::download.file(url, destfile = temp, quiet = T)
if(as.numeric(ncol(readr::read_csv(temp)) == 1))
stop("unkwown series")
output <- readr::read_csv(temp, col_types = readr::cols()) %>%
janitor::clean_names() %>%
dplyr::mutate(date = as.Date(date, "%d %b %Y"),
value = as.numeric(value))
unlink(temp)
output
}
get_boe("xumauss")
get_boe <- function(series, from = as.Date("1975-01-01"), to = Sys.Date()){
if(class(from) != "Date" | class(to) != "Date")
stop("to and from must be dates")
url <- paste0("http://www.bankofengland.co.uk/boeapps/iadb/fromshowcolumns.asp?csv.x=yes",
"&Datefrom=", format.Date(from, "%d/%b/%Y"),
"&Dateto=", format.Date(to, "%d/%b/%Y"),
"&SeriesCodes=", paste(toupper(series), collapse = ","),
"&CSVF=CN&UsingCodes=Y&VPD=Y&VFD=N")
temp <- tempfile()
utils::download.file(url, destfile = temp, quiet = T)
if(as.numeric(ncol(readr::read_csv(temp)) <= 1))
stop("unkwown series")
output <- readr::read_csv(temp, col_types = readr::cols()) %>%
janitor::clean_names() %>%
dplyr::mutate(date = as.Date(date, "%d %b %Y"),
value = as.numeric(value))
unlink(temp)
output
}
get_boe("xumauss")
get_boe <- function(series, from = as.Date("1975-01-01"), to = Sys.Date()){
if(class(from) != "Date" | class(to) != "Date")
stop("to and from must be dates")
url <- paste0("http://www.bankofengland.co.uk/boeapps/iadb/fromshowcolumns.asp?csv.x=yes",
"&Datefrom=", format.Date(from, "%d/%b/%Y"),
"&Dateto=", format.Date(to, "%d/%b/%Y"),
"&SeriesCodes=", paste(toupper(series), collapse = ","),
"&CSVF=CN&UsingCodes=Y&VPD=Y&VFD=N")
temp <- tempfile()
utils::download.file(url, destfile = temp, quiet = T)
if(ncol(readr::read_csv(temp) <= 1))
stop("unkwown series")
output <- readr::read_csv(temp, col_types = readr::cols()) %>%
janitor::clean_names() %>%
dplyr::mutate(date = as.Date(date, "%d %b %Y"),
value = as.numeric(value))
unlink(temp)
output
}
get_boe("xumauss")
get_boe <- function(series, from = as.Date("1975-01-01"), to = Sys.Date()){
if(class(from) != "Date" | class(to) != "Date")
stop("to and from must be dates")
url <- paste0("http://www.bankofengland.co.uk/boeapps/iadb/fromshowcolumns.asp?csv.x=yes",
"&Datefrom=", format.Date(from, "%d/%b/%Y"),
"&Dateto=", format.Date(to, "%d/%b/%Y"),
"&SeriesCodes=", paste(toupper(series), collapse = ","),
"&CSVF=CN&UsingCodes=Y&VPD=Y&VFD=N")
temp <- tempfile()
utils::download.file(url, destfile = temp, quiet = T)
if(as.integer(ncol(suppressMessages(supressWarnings(readr::read_csv(temp) <= 1)))))
stop("unkwown series")
output <- readr::read_csv(temp, col_types = readr::cols()) %>%
janitor::clean_names() %>%
dplyr::mutate(date = as.Date(date, "%d %b %Y"),
value = as.numeric(value))
unlink(temp)
output
}
get_boe("xumauss")
get_boe <- function(series, from = as.Date("1975-01-01"), to = Sys.Date()){
if(class(from) != "Date" | class(to) != "Date")
stop("to and from must be dates")
url <- paste0("http://www.bankofengland.co.uk/boeapps/iadb/fromshowcolumns.asp?csv.x=yes",
"&Datefrom=", format.Date(from, "%d/%b/%Y"),
"&Dateto=", format.Date(to, "%d/%b/%Y"),
"&SeriesCodes=", paste(toupper(series), collapse = ","),
"&CSVF=CN&UsingCodes=Y&VPD=Y&VFD=N")
temp <- tempfile()
utils::download.file(url, destfile = temp, quiet = T)
if(as.integer(ncol(suppressMessages(suppressWarnings(readr::read_csv(temp) <= 1)))))
stop("unkwown series")
output <- readr::read_csv(temp, col_types = readr::cols()) %>%
janitor::clean_names() %>%
dplyr::mutate(date = as.Date(date, "%d %b %Y"),
value = as.numeric(value))
unlink(temp)
output
}
get_boe("xumauss")
get_boe <- function(series, from = as.Date("1975-01-01"), to = Sys.Date()){
if(class(from) != "Date" | class(to) != "Date")
stop("to and from must be dates")
url <- paste0("http://www.bankofengland.co.uk/boeapps/iadb/fromshowcolumns.asp?csv.x=yes",
"&Datefrom=", format.Date(from, "%d/%b/%Y"),
"&Dateto=", format.Date(to, "%d/%b/%Y"),
"&SeriesCodes=", paste(toupper(series), collapse = ","),
"&CSVF=CN&UsingCodes=Y&VPD=Y&VFD=N")
temp <- tempfile()
utils::download.file(url, destfile = temp, quiet = T)
if(as.numierc(ncol(suppressMessages(suppressWarnings(readr::read_csv(temp) <= 1)))))
stop("unkwown series")
output <- readr::read_csv(temp, col_types = readr::cols()) %>%
janitor::clean_names() %>%
dplyr::mutate(date = as.Date(date, "%d %b %Y"),
value = as.numeric(value))
unlink(temp)
output
}
get_boe("xumauss")
get_boe <- function(series, from = as.Date("1975-01-01"), to = Sys.Date()){
if(class(from) != "Date" | class(to) != "Date")
stop("to and from must be dates")
url <- paste0("http://www.bankofengland.co.uk/boeapps/iadb/fromshowcolumns.asp?csv.x=yes",
"&Datefrom=", format.Date(from, "%d/%b/%Y"),
"&Dateto=", format.Date(to, "%d/%b/%Y"),
"&SeriesCodes=", paste(toupper(series), collapse = ","),
"&CSVF=CN&UsingCodes=Y&VPD=Y&VFD=N")
temp <- tempfile()
utils::download.file(url, destfile = temp, quiet = T)
if(as.numeric(ncol(suppressMessages(suppressWarnings(readr::read_csv(temp) <= 1)))))
stop("unkwown series")
output <- readr::read_csv(temp, col_types = readr::cols()) %>%
janitor::clean_names() %>%
dplyr::mutate(date = as.Date(date, "%d %b %Y"),
value = as.numeric(value))
unlink(temp)
output
}
get_boe("xumauss")
as.numeric(ncol(suppressMessages(suppressWarnings(readr::read_csv(temp)
as.numeric(ncol(suppressMessages(suppressWarnings(readr::read_csv(temp)))))
get_boe <- function(series, from = as.Date("1975-01-01"), to = Sys.Date()){
if(class(from) != "Date" | class(to) != "Date")
stop("to and from must be dates")
url <- paste0("http://www.bankofengland.co.uk/boeapps/iadb/fromshowcolumns.asp?csv.x=yes",
"&Datefrom=", format.Date(from, "%d/%b/%Y"),
"&Dateto=", format.Date(to, "%d/%b/%Y"),
"&SeriesCodes=", paste(toupper(series), collapse = ","),
"&CSVF=CN&UsingCodes=Y&VPD=Y&VFD=N")
temp <- tempfile()
utils::download.file(url, destfile = temp, quiet = T)
if(as.numeric(ncol(readr::read_csv(temp) <= 1)))
stop("unkwown series")
output <- readr::read_csv(temp, col_types = readr::cols()) %>%
janitor::clean_names() %>%
dplyr::mutate(date = as.Date(date, "%d %b %Y"),
value = as.numeric(value))
unlink(temp)
output
}
get_boe("xumauss")
the <- as.numeric(ncol(readr::read_csv(temp)))
class(1)
get_boe <- function(series, from = as.Date("1975-01-01"), to = Sys.Date()){
if(class(from) != "Date" | class(to) != "Date")
stop("to and from must be dates")
url <- paste0("http://www.bankofengland.co.uk/boeapps/iadb/fromshowcolumns.asp?csv.x=yes",
"&Datefrom=", format.Date(from, "%d/%b/%Y"),
"&Dateto=", format.Date(to, "%d/%b/%Y"),
"&SeriesCodes=", paste(toupper(series), collapse = ","),
"&CSVF=CN&UsingCodes=Y&VPD=Y&VFD=N")
temp <- tempfile()
utils::download.file(url, destfile = temp, quiet = T)
if(as.numeric(ncol(suppressMessages(suppressWarnings)readr::read_csv(temp))) <= 1)
stop("unkwown series")
output <- readr::read_csv(temp, col_types = readr::cols()) %>%
janitor::clean_names() %>%
dplyr::mutate(date = as.Date(date, "%d %b %Y"),
value = as.numeric(value))
unlink(temp)
output
}
get_boe <- function(series, from = as.Date("1975-01-01"), to = Sys.Date()){
if(class(from) != "Date" | class(to) != "Date")
stop("to and from must be dates")
url <- paste0("http://www.bankofengland.co.uk/boeapps/iadb/fromshowcolumns.asp?csv.x=yes",
"&Datefrom=", format.Date(from, "%d/%b/%Y"),
"&Dateto=", format.Date(to, "%d/%b/%Y"),
"&SeriesCodes=", paste(toupper(series), collapse = ","),
"&CSVF=CN&UsingCodes=Y&VPD=Y&VFD=N")
temp <- tempfile()
utils::download.file(url, destfile = temp, quiet = T)
if(as.numeric(ncol(suppressMessages(suppressWarnings(readr::read_csv(temp))))) <= 1)
stop("unkwown series")
output <- readr::read_csv(temp, col_types = readr::cols()) %>%
janitor::clean_names() %>%
dplyr::mutate(date = as.Date(date, "%d %b %Y"),
value = as.numeric(value))
unlink(temp)
output
}
get_boe("xumauss")
get_boe <- function(series, from = as.Date("1975-01-01"), to = Sys.Date()){
if(class(from) != "Date" | class(to) != "Date")
stop("to and from must be dates")
url <- paste0("http://www.bankofengland.co.uk/boeapps/iadb/fromshowcolumns.asp?csv.x=yes",
"&Datefrom=", format.Date(from, "%d/%b/%Y"),
"&Dateto=", format.Date(to, "%d/%b/%Y"),
"&SeriesCodes=", paste(toupper(series), collapse = ","),
"&CSVF=CN&UsingCodes=Y&VPD=Y&VFD=N")
temp <- tempfile()
utils::download.file(url, destfile = temp, quiet = T)
if(ncol(suppressMessages(suppressWarnings(readr::read_csv(temp)))) <= 1)
stop("unkwown series")
output <- readr::read_csv(temp, col_types = readr::cols()) %>%
janitor::clean_names() %>%
dplyr::mutate(date = as.Date(date, "%d %b %Y"),
value = as.numeric(value))
unlink(temp)
output
}
get_boe("xumauss")
get_boe("dick")
library(economi)
get_ons("yourbut", "emp")
get_ons <- function(series, dataset){
options(error = NULL)
get_data <- function(series){
id <- tolower(series)
dataset <- tolower(dataset)
url <- paste0("https://api.ons.gov.uk/dataset/",
dataset,
"/timeseries/" ,
series,
"/data")
request <- httr::GET(url)
if(request$status_code == 404)
stop("unknown series or dataset")
raw <- httr::content(request, "text", encoding = "UTF-8") %>%
jsonlite::fromJSON()
df <- raw$months  %>%
dplyr::mutate(series = series,
dataset = dataset,
date = lubridate::ymd(paste(date, "01", sep = " ")),
value = as.numeric(value)) %>%
dplyr::select(date, interval, series, dataset, value)
df
}
output <- purrr::map_dfr(series, get_data)
output
}
get_ons("yourbut", "emp")
?options
get_ons <- function(series, dataset){
options(error = NULL)
get_data <- function(series){
id <- tolower(series)
dataset <- tolower(dataset)
url <- paste0("https://api.ons.gov.uk/dataset/",
dataset,
"/timeseries/" ,
series,
"/data")
request <- httr::GET(url)
if(request$status_code == 404)
stop("unknown series or dataset", call. = F)
raw <- httr::content(request, "text", encoding = "UTF-8") %>%
jsonlite::fromJSON()
df <- raw$months  %>%
dplyr::mutate(series = series,
dataset = dataset,
date = lubridate::ymd(paste(date, "01", sep = " ")),
value = as.numeric(value)) %>%
dplyr::select(date, interval, series, dataset, value)
df
}
output <- purrr::map_dfr(series, get_data)
output
}
get_ons("yourbut", "emp")
library(economi)
get_ons("yourbut", "emp")
get_boe("dick")
library(economi)
get_boe("dick")
library(economi)
get_boe("dick")
get_boe("dick")
library(economi)
get_boe("dick")
library(economi)
get_boe("dick")
library(economi)
get_boe("dick")
get_boe("dick", "dick")
library(economi)
get_boe("dick", "dick")
get_ons("dick")
get_ons("dick", "dick")
?get_ons
?get_boe
